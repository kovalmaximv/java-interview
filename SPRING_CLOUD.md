# Spring Cloud
### Что это
Spring Cloud позволяет не реализовывать некоторые распределенные паттерны и часто используемые вспомогательные сервисы.
По аналогии со Spring Boot он позволяет из коробки развернуть и донастроить спринговый сервис, который будет решать
поставленные задачи. 

Предлагаемые сервисы:
- Distributed/versioned configuration
- Service registration and discovery
- Routing
- Service-to-service calls
- Load balancing
- Circuit Breakers
- Global locks
- Leadership election and cluster state
- Distributed messaging
- etc

### Spring Cloud Config
Данный инструмент позволяет реализовать Config Server, который будет подтягивать конфиги из git репы. Сервисы будут 
подтягивать конфигурацию с данного Config Server.

Config Server позволяешь шифровать и дешифровать значения. Таким образом в нем можно хранить зашифрованные sensitive
данные, которые сервис дешифрует при получении.

### Spring Cloud Service discovery
Данный инструмент решаем проблему service discovery, когда есть единый сервер (в нашем случае Eureka), который хранит
url до API всех зарегистрированных сервисов. Сервисы в нем регистрируются, раз в 30 секунд отправляют heartbeat и 
получают данные о расположении остальных API. 

Сущности в Eureka:
1) Eureka Client - микросервис, готовый работать с Eureka.
2) Eureka Instance - инстанс микросервиса (может быть несколько)
3) Eureka Service - когда инстанс регистрируется в Eureka, он регистрирует Eureka Service с каким-то ID
4) Eureka Server - непосредственно сервер Eureka, хранящий данные о сервисах

![img.png](png/eureka_entities.png)

Когда клиент регистрируется в Eureka, он предоставляет метаданные о себе - такие как хост, порт, URL—адрес health check, 
домашняя страница и другие сведения. Eureka получает сообщения о heartbeat от каждого экземпляра, принадлежащего службе. 
Если heartbeat завершается сбоем по настраиваемому расписанию (по умолчанию каждые 30 сек), экземпляр обычно удаляется 
из реестра. У клиентов есть кэш регистраций других сервисов в Eureka, поэтому им не нужно обращаться к реестру для 
каждого запроса к сервису.

Service считается доступным к вызовам только в том случае, если instance, server и client имеют одинаковые данные в кеше.
Для этого может понадобиться 3 вызова heartbeat.

Eureka Instances могут быть расположены в разных зонах (например географических), если указать необходимые конфигурации,
то Eureka будет сначала отправлять в необходимые сервисы той же зоны, что и запрашивающий сервис. И только потом в 
другие зоны, если первый вызов неудачный.

Eureka Client - refreshable бины, так что пропертя клиента можно изменить и если это произойдет, эти инстансы 
снимутся с регистрации в Eureka.

### 